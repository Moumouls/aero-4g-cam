name: Generate Video

on:
  workflow_dispatch:
  pull_request:
    types: [opened, synchronize]
  schedule:
    # Samedi : 9h, 10h, 11h, 14h, 15h, 16h (Europe/Paris été UTC+2)
    # En hiver (UTC+1) : 8h, 9h, 10h, 13h, 14h, 15h
    - cron: "0 7,8,9,12,13,14 * * 6"
    # Dimanche : 9h, 10h, 11h, 14h, 15h, 16h (Europe/Paris été UTC+2)
    # En hiver (UTC+1) : 8h, 9h, 10h, 13h, 14h, 15h
    - cron: "0 7,8,9,12,13,14 * * 0"

jobs:
  attempt-1:
    name: Generate Video (Attempt 1)
    uses: ./.github/workflows/generate-video-job.yml
    secrets: inherit

  attempt-2:
    name: Generate Video (Attempt 2)
    needs: attempt-1
    if: failure()
    uses: ./.github/workflows/generate-video-job.yml
    secrets: inherit

  attempt-3:
    name: Generate Video (Attempt 3 - Final)
    needs: [attempt-1, attempt-2]
    if: always() && needs.attempt-1.result == 'failure' && needs.attempt-2.result == 'failure'
    uses: ./.github/workflows/generate-video-job.yml
    secrets: inherit
