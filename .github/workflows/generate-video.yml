name: Generate Video

on:
  workflow_dispatch:
  pull_request:
    types: [opened, synchronize]

# Schedules are managed in Cloudflare Cron Triggers

jobs:
  attempt-1:
    name: Generate Video (Attempt 1)
    uses: ./.github/workflows/generate-video-job.yml
    secrets: inherit

  attempt-2:
    name: Generate Video (Attempt 2)
    needs: attempt-1
    if: failure()
    uses: ./.github/workflows/generate-video-job.yml
    secrets: inherit

  attempt-3:
    name: Generate Video (Attempt 3 - Final)
    needs: [attempt-1, attempt-2]
    if: always() && needs.attempt-1.result == 'failure' && needs.attempt-2.result == 'failure'
    uses: ./.github/workflows/generate-video-job.yml
    secrets: inherit
